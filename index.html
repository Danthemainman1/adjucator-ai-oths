<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adjudicator AI</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Tailwind Configuration for Dark Mode -->
    <script>
        tailwind.config = {
            darkMode: 'class', // or 'media'
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                },
            },
        }
    </script>

    <!-- React & ReactDOM via ESM -->
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "lucide-react": "https://esm.sh/lucide-react@0.263.1"
      }
    }
    </script>
    
    <!-- Babel for JSX translation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Firebase SDKs (Modular) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, updateDoc, arrayUnion } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // --- PASTE YOUR FIREBASE CONFIG HERE ---
        const firebaseConfig = {
            apiKey: "AIzaSyAgGkHhRcdGatNvRsm5BQv_RerjG8qt70M",
            authDomain: "adjucator-ai.firebaseapp.com",
            projectId: "adjucator-ai",
            storageBucket: "adjucator-ai.firebasestorage.app",
            messagingSenderId: "82725691768",
            appId: "1:82725691768:web:6186a5b41b8a0aa1e7688d",
            measurementId: "G-N92VEHSKDE"
        };
        // ---------------------------------------

        const app = initializeApp(firebaseConfig);
        window.auth = getAuth(app);
        window.db = getFirestore(app);
        window.firebaseAuth = { createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged };
        window.firebaseDb = { doc, setDoc, getDoc, updateDoc, arrayUnion };
    </script>

    <style>
        body { font-family: 'Inter', sans-serif; }
        /* Hide scrollbar for cleaner UI */
        textarea::-webkit-scrollbar { width: 8px; }
        textarea::-webkit-scrollbar-track { background: transparent; }
        textarea::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 20px; }

        /* Neon Theme Overrides */
        .theme-neon body { background-color: #000000 !important; color: #00ff41 !important; }
        .theme-neon .bg-white, .theme-neon .bg-slate-50, .theme-neon .bg-slate-100, .theme-neon .bg-slate-200, .theme-neon .bg-slate-800, .theme-neon .bg-slate-900 {
            background-color: #0a0a0a !important;
            border-color: #333 !important;
            color: #00ff41 !important;
        }
        .theme-neon header { border-bottom: 1px solid #00ff41 !important; }
        .theme-neon .text-slate-900, .theme-neon .text-slate-700, .theme-neon .text-slate-500, .theme-neon .text-slate-400 { color: #00ff41 !important; }
        .theme-neon .text-indigo-600, .theme-neon .text-indigo-500, .theme-neon .text-purple-600 { color: #d900ff !important; text-shadow: 0 0 2px #d900ff; }
        .theme-neon button, .theme-neon input, .theme-neon select, .theme-neon textarea {
            background-color: #050505 !important;
            border: 1px solid #00ff41 !important;
            color: #00ff41 !important;
        }
        .theme-neon .bg-indigo-600, .theme-neon .bg-gradient-to-r {
            background: #d900ff !important;
            color: #fff !important;
            box-shadow: 0 0 10px #d900ff;
            border: none !important;
        }

        /* Theme: Forest */
        .theme-forest body { background-color: #1c2321 !important; color: #e8f5e9 !important; }
        .theme-forest .bg-white, .theme-forest .bg-slate-50, .theme-forest .bg-slate-100, .theme-forest .bg-slate-200, .theme-forest .bg-slate-800, .theme-forest .bg-slate-900 {
            background-color: #2d3b36 !important;
            border-color: #4a5d55 !important;
            color: #e8f5e9 !important;
        }
        .theme-forest .text-slate-900, .theme-forest .text-slate-700, .theme-forest .text-slate-500, .theme-forest .text-slate-400 { color: #b8cbb8 !important; }
        .theme-forest .text-indigo-600, .theme-forest .text-indigo-500, .theme-forest .text-purple-600 { color: #76c893 !important; }
        .theme-forest button, .theme-forest input, .theme-forest select, .theme-forest textarea {
            background-color: #1c2321 !important;
            border: 1px solid #4a5d55 !important;
            color: #e8f5e9 !important;
        }
        .theme-forest .bg-indigo-600, .theme-forest .bg-gradient-to-r {
            background: linear-gradient(to right, #2d6a4f, #40916c) !important;
            border: none !important;
        }

        /* Theme: Coffee */
        .theme-coffee body { background-color: #2b2118 !important; color: #dcc8b3 !important; }
        .theme-coffee .bg-white, .theme-coffee .bg-slate-50, .theme-coffee .bg-slate-100, .theme-coffee .bg-slate-200, .theme-coffee .bg-slate-800, .theme-coffee .bg-slate-900 {
            background-color: #3d2f24 !important;
            border-color: #5c4738 !important;
            color: #dcc8b3 !important;
        }
        .theme-coffee .text-slate-900, .theme-coffee .text-slate-700, .theme-coffee .text-slate-500, .theme-coffee .text-slate-400 { color: #a69076 !important; }
        .theme-coffee .text-indigo-600, .theme-coffee .text-indigo-500, .theme-coffee .text-purple-600 { color: #d2691e !important; }
        .theme-coffee button, .theme-coffee input, .theme-coffee select, .theme-coffee textarea {
            background-color: #2b2118 !important;
            border: 1px solid #5c4738 !important;
            color: #dcc8b3 !important;
        }
        .theme-coffee .bg-indigo-600, .theme-coffee .bg-gradient-to-r {
            background: linear-gradient(to right, #8b4513, #a0522d) !important;
            border: none !important;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 dark:bg-slate-900 dark:text-slate-100">
    
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useRef, useEffect } from 'react';
        import { createRoot } from 'react-dom/client';
        import { 
            Gavel, 
            Mic, 
            Settings, 
            AlertCircle, 
            CheckCircle2, 
            ChevronDown, 
            Send, 
            Loader2, 
            Award, 
            BookOpen, 
            Layout, 
            Image as ImageIcon, 
            Upload, 
            X, 
            Plus, 
            Square, 
            Activity,
            HelpCircle,
            Palette,
            Lightbulb,
            Moon,
            Sun,
            Zap,
            Coffee,
            Leaf,
            History,
            Trash2,
            Download,
            Copy,
            LogOut,
            User,
            Lock
        } from 'lucide-react';

        // --- Components ---

        const MarkdownRenderer = ({ content }) => {
            if (!content) return null;

            const parseInline = (text) => {
                const parts = text.split(/(\*\*.*?\*\*)/g);
                return parts.map((part, index) => {
                    if (part.startsWith('**') && part.endsWith('**')) {
                        return <strong key={index} className="font-bold text-indigo-700 dark:text-indigo-300">{part.slice(2, -2)}</strong>;
                    }
                    return part;
                });
            };
            
            const lines = content.split('\n');
            
            return (
                <div className="space-y-2 text-slate-700 dark:text-slate-300 leading-relaxed">
                {lines.map((line, i) => {
                    if (line.startsWith('#### ')) {
                        return <h4 key={i} className="text-md font-bold text-slate-800 dark:text-slate-200 mt-4 mb-2">{parseInline(line.replace('#### ', ''))}</h4>;
                    }
                    if (line.startsWith('### ')) {
                        return <h3 key={i} className="text-lg font-semibold text-slate-800 dark:text-slate-200 mt-4 mb-2">{parseInline(line.replace('### ', ''))}</h3>;
                    }
                    if (line.startsWith('## ')) {
                        return <h2 key={i} className="text-xl font-bold text-indigo-600 dark:text-indigo-400 mt-6 mb-3 border-b border-slate-200 dark:border-slate-700 pb-2">{parseInline(line.replace('## ', ''))}</h2>;
                    }
                    if (line.trim().startsWith('* ') || line.trim().startsWith('- ')) {
                        return (
                            <div key={i} className="flex items-start space-x-2 ml-4">
                                <span className="text-indigo-500 mt-1.5">â€¢</span>
                                <span>{parseInline(line.replace(/^[\*\-]\s/, ''))}</span>
                            </div>
                        );
                    }
                    if (line.trim() === '') return <div key={i} className="h-2"></div>;
                    
                    return <p key={i}>{parseInline(line)}</p>;
                })}
                </div>
            );
        };

        function App() {
            // State Management
            const [activeTab, setActiveTab] = useState('speech'); 
            const [provider, setProvider] = useState('gemini'); // gemini, openai
            const [apiKey, setApiKey] = useState('');
            const [openaiKey, setOpenaiKey] = useState('');
            const [loading, setLoading] = useState(false);
            const [result, setResult] = useState(null);
            const [error, setError] = useState('');
            const [showHelp, setShowHelp] = useState(false);
            const [showHistory, setShowHistory] = useState(false);
            const [history, setHistory] = useState([]);
            const [theme, setTheme] = useState('light'); // light, dark, neon
            
            // Auth State
            const [user, setUser] = useState(null);
            const [showLogin, setShowLogin] = useState(true);
            const [authMode, setAuthMode] = useState('login'); // login, signup
            const [authEmail, setAuthEmail] = useState('');
            const [authPassword, setAuthPassword] = useState('');
            const [authError, setAuthError] = useState('');
            const [isFirebaseReady, setIsFirebaseReady] = useState(false);

            useEffect(() => {
                const savedTheme = localStorage.getItem('theme') || 'light';
                setTheme(savedTheme);
                
                // Check if Firebase is initialized
                if (window.auth && window.firebaseAuth) {
                    setIsFirebaseReady(true);
                    const unsubscribe = window.firebaseAuth.onAuthStateChanged(window.auth, (currentUser) => {
                        if (currentUser) {
                            setUser(currentUser);
                            setShowLogin(false);
                            loadUserHistory(currentUser.uid);
                        } else {
                            setUser(null);
                            setShowLogin(true);
                        }
                    });
                    return () => unsubscribe();
                } else {
                    // Fallback for when config is missing
                    console.warn("Firebase not configured. Using local storage fallback.");
                    const sessionUser = localStorage.getItem('activeUser');
                    if (sessionUser) {
                        const userData = JSON.parse(sessionUser);
                        setUser(userData);
                        setShowLogin(false);
                        loadUserHistory(userData.email); // Fallback uses email as ID
                    }
                }
            }, []);

            // Load history
            const loadUserHistory = async (userId) => {
                if (window.db && window.firebaseDb) {
                    try {
                        const docRef = window.firebaseDb.doc(window.db, "users", userId);
                        const docSnap = await window.firebaseDb.getDoc(docRef);
                        if (docSnap.exists()) {
                            setHistory(docSnap.data().history || []);
                        } else {
                            setHistory([]);
                        }
                    } catch (e) {
                        console.error("Error loading history:", e);
                    }
                } else {
                    // Fallback
                    const savedHistory = localStorage.getItem(`debateHistory_${userId}`);
                    if (savedHistory) setHistory(JSON.parse(savedHistory));
                    else setHistory([]);
                }
            };

            // Save history
            const saveHistoryToCloud = async (newHistory, userId) => {
                if (window.db && window.firebaseDb) {
                    try {
                        const userRef = window.firebaseDb.doc(window.db, "users", userId);
                        await window.firebaseDb.setDoc(userRef, { history: newHistory }, { merge: true });
                    } catch (e) {
                        console.error("Error saving history:", e);
                    }
                }
            };

            // Effect to sync history changes
            useEffect(() => {
                if (user) {
                    const userId = user.uid || user.email;
                    // Local backup
                    localStorage.setItem(`debateHistory_${userId}`, JSON.stringify(history));
                    
                    // Cloud sync
                    if (user.uid && window.db) {
                        saveHistoryToCloud(history, user.uid);
                    }
                }
            }, [history, user]);

            // Help Popup Logic
            useEffect(() => {
                if (user && !showLogin) {
                    const userId = user.uid || user.email;
                    const hasVisited = localStorage.getItem(`hasVisited_${userId}`);
                    if (!hasVisited) {
                        setShowHelp(true);
                        localStorage.setItem(`hasVisited_${userId}`, 'true');
                    }
                }
            }, [user, showLogin]);

            const handleAuth = async (e) => {
                e.preventDefault();
                setAuthError('');
                
                if (!authEmail || !authPassword) {
                    setAuthError('Please fill in all fields');
                    return;
                }

                if (window.auth && window.firebaseAuth && window.auth.app.options.apiKey !== "YOUR_API_KEY_HERE") {
                    // Firebase Auth
                    try {
                        if (authMode === 'signup') {
                            await window.firebaseAuth.createUserWithEmailAndPassword(window.auth, authEmail, authPassword);
                            // User is automatically signed in by Firebase
                        } else {
                            await window.firebaseAuth.signInWithEmailAndPassword(window.auth, authEmail, authPassword);
                        }
                        setAuthEmail('');
                        setAuthPassword('');
                    } catch (error) {
                        let msg = error.message;
                        if (error.code === 'auth/invalid-credential') msg = 'Invalid email or password.';
                        if (error.code === 'auth/email-already-in-use') msg = 'Email already in use.';
                        if (error.code === 'auth/weak-password') msg = 'Password should be at least 6 characters.';
                        setAuthError(msg);
                    }
                } else {
                    // Local Storage Fallback (Demo Mode)
                    const users = JSON.parse(localStorage.getItem('registeredUsers') || '{}');
                    if (authMode === 'signup') {
                        if (users[authEmail]) { setAuthError('User already exists'); return; }
                        users[authEmail] = authPassword;
                        localStorage.setItem('registeredUsers', JSON.stringify(users));
                        loginUserLocal(authEmail);
                    } else {
                        if (users[authEmail] && users[authEmail] === authPassword) {
                            loginUserLocal(authEmail);
                        } else {
                            setAuthError('Invalid email or password (Demo Mode)');
                        }
                    }
                }
            };

            const loginUserLocal = (email) => {
                const userData = { email, uid: null }; // No UID for local users
                setUser(userData);
                localStorage.setItem('activeUser', JSON.stringify(userData));
                setShowLogin(false);
                loadUserHistory(email);
                setAuthEmail('');
                setAuthPassword('');
            };

            const logout = async () => {
                if (window.auth && window.firebaseAuth) {
                    try {
                        await window.firebaseAuth.signOut(window.auth);
                    } catch (e) { console.error(e); }
                }
                setUser(null);
                localStorage.removeItem('activeUser');
                setShowLogin(true);
                setHistory([]);
                setResult(null);
                setTranscript('');
                setBoardImages([]);
                setAudioData(null);
            };

            useEffect(() => {
                const root = document.documentElement;
                const body = document.body;
                
                // Reset
                root.classList.remove('dark');
                body.classList.remove('theme-neon', 'theme-forest', 'theme-coffee');
                
                if (theme === 'dark') {
                    root.classList.add('dark');
                } else if (theme === 'neon') {
                    root.classList.add('dark');
                    body.classList.add('theme-neon');
                } else if (theme === 'forest') {
                    root.classList.add('dark');
                    body.classList.add('theme-forest');
                } else if (theme === 'coffee') {
                    root.classList.add('dark');
                    body.classList.add('theme-coffee');
                }
                
                localStorage.setItem('theme', theme);
            }, [theme]);

            useEffect(() => {
                const hasVisited = localStorage.getItem('hasVisited');
                if (!hasVisited) {
                    setShowHelp(true);
                    localStorage.setItem('hasVisited', 'true');
                }
            }, []);
            
            // Speech Form State
            const [speechType, setSpeechType] = useState('Public Forum (PF)');
            const [side, setSide] = useState('Proposition/Affirmative');
            const [topic, setTopic] = useState('');
            const [transcript, setTranscript] = useState('');

            // Board Form State
            const [boardDescription, setBoardDescription] = useState('');
            const [boardImages, setBoardImages] = useState([]); 
            const fileInputRef = useRef(null);

            // Audio Recording State
            const [isRecording, setIsRecording] = useState(false);
            const [recordingTime, setRecordingTime] = useState(0);
            const [audioData, setAudioData] = useState(null); 
            const mediaRecorderRef = useRef(null);
            const timerRef = useRef(null);
            const chunksRef = useRef([]);

            // Options
            const speechTypes = [
                'Policy Debate (CX)', 'Lincoln-Douglas (LD)', 'Public Forum (PF)', 'Big Questions Debate',
                'World Schools Debate', 'Congressional Debate', 'Original Oratory (OO)', 'Informative Speaking (INFO)',
                'United States Extemp (USX)', 'International Extemp (IX)', 'Dramatic Interpretation (DI)',
                'Humorous Interpretation (HI)', 'Duo Interpretation', 'Program Oral Interpretation (POI)',
                'Impromptu', 'Extemporaneous Commentary', 'Expository', 'Storytelling', 'Prose/Poetry',
                'Parliamentary (British)', 'Parliamentary (Asian)', 'Model UN Speech', 'After Dinner Speaking', 'Toast/Ceremonial'
            ];

            const sides = [
                'Proposition/Affirmative', 'Opposition/Negative', 'Government', 'Opposition',
                'Pro', 'Con', 'Opening Member', 'Closing Member/Whip', 'Sponsor (Congress)',
                'Individual/Solo', 'Neutral/Evaluator'
            ];

            // Handlers
            const handleImageUpload = (e) => {
                const files = Array.from(e.target.files);
                if (files.length === 0) return;
                files.forEach(file => {
                    if (file.size > 4 * 1024 * 1024) {
                        setError(prev => (prev ? `${prev} ` : '') + `Skipped ${file.name} (too large).`);
                        return;
                    }
                    const reader = new FileReader();
                    reader.onloadend = () => {
                        const base64String = reader.result.split(',')[1];
                        setBoardImages(prev => [...prev, {
                            id: Math.random().toString(36).substr(2, 9),
                            url: reader.result,
                            raw: base64String,
                            mimeType: file.type,
                            name: file.name
                        }]);
                    };
                    reader.readAsDataURL(file);
                });
                if (fileInputRef.current) fileInputRef.current.value = '';
            };

            const removeImage = (id) => {
                setBoardImages(prev => prev.filter(img => img.id !== id));
            };

            const formatTime = (seconds) => {
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
            };

            const startRecording = async () => {
                setError('');
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    mediaRecorderRef.current = new MediaRecorder(stream);
                    chunksRef.current = [];
                    mediaRecorderRef.current.ondataavailable = (e) => {
                        if (e.data.size > 0) chunksRef.current.push(e.data);
                    };
                    mediaRecorderRef.current.onstop = () => {
                        const blob = new Blob(chunksRef.current, { type: 'audio/webm' });
                        const reader = new FileReader();
                        reader.readAsDataURL(blob);
                        reader.onloadend = () => {
                            const base64String = reader.result.split(',')[1];
                            setAudioData({ raw: base64String, mimeType: blob.type });
                        };
                        stream.getTracks().forEach(track => track.stop());
                    };
                    mediaRecorderRef.current.start();
                    setIsRecording(true);
                    setRecordingTime(0);
                    setAudioData(null);
                    timerRef.current = setInterval(() => setRecordingTime(prev => prev + 1), 1000);
                } catch (err) {
                    setError("Could not access microphone. Ensure permissions are granted (may require HTTPS or localhost).");
                    console.error(err);
                }
            };

            const stopRecording = () => {
                if (mediaRecorderRef.current && isRecording) {
                    mediaRecorderRef.current.stop();
                    setIsRecording(false);
                    clearInterval(timerRef.current);
                }
            };

            const resetAudio = () => {
                setAudioData(null);
                setRecordingTime(0);
                setError('');
            };

            const addToHistory = (text, type) => {
                const newItem = {
                    id: Date.now(),
                    date: new Date().toLocaleString(),
                    type,
                    topic: topic || 'Untitled',
                    content: text
                };
                setHistory(prev => [newItem, ...prev]);
            };

            const clearHistory = () => {
                if (confirm('Are you sure you want to clear all history?')) {
                    setHistory([]);
                }
            };

            const handleAnalyze = async (isBoardGen = false) => {
                const currentKey = provider === 'gemini' ? apiKey : openaiKey;
                if (!currentKey) { setError(`Please enter a valid ${provider === 'gemini' ? 'Gemini' : 'OpenAI'} API Key.`); return; }
                
                if (!isBoardGen) {
                    if (activeTab === 'speech' && !transcript) { setError('Please enter speech text.'); return; }
                    if (activeTab === 'board' && !boardDescription && boardImages.length === 0) { setError('Please provide images or description.'); return; }
                    if (activeTab === 'listen' && !audioData) { setError('Please record audio first.'); return; }
                    if (activeTab === 'listen' && provider === 'openai') { setError('Live Audio analysis is currently only available with Gemini.'); return; }
                }
                
                setLoading(true);
                setError('');
                setResult(null);

                try {
                    let generatedText = '';

                    if (provider === 'gemini') {
                        let payloadParts = [];
                        let systemPrompt = '';
                        
                        // Prompt Construction
                        if (isBoardGen) {
                             systemPrompt = `Act as an expert Debate Coach. For the topic "${topic}" and side "${side}" in ${speechType} format, describe an ideal debate board/flow layout. 
                             Include:
                             1. Strategic grouping of arguments.
                             2. How to use colors/columns effectively.
                             3. A text-based outline of the main content blocks.
                             4. Key "win conditions" to highlight on the board.
                             Do NOT generate an image, just a detailed text description.`;
                             payloadParts = [{ text: systemPrompt }];
                        } else if (activeTab === 'speech') {
                            systemPrompt = `You are an expert Debate Adjudicator. Context: ${speechType}, ${side}, Topic: ${topic}. Evaluate the speech text. Provide Score (0-100), Summary, Strengths, Weaknesses, Advice. SPEECH: ${transcript}`;
                            payloadParts = [{ text: systemPrompt }];
                        } else if (activeTab === 'board') {
                            systemPrompt = `Expert Debate Coach (Flowing). Evaluate board/flow. Context: ${speechType}, ${side}, Topic: ${topic}. Assess Organization, Grouping, Legibility, Suggestions. User Notes: ${boardDescription}`;
                            payloadParts = [{ text: systemPrompt }];
                            boardImages.forEach(img => payloadParts.push({ inlineData: { mimeType: img.mimeType, data: img.raw } }));
                        } else if (activeTab === 'listen') {
                            systemPrompt = `Expert Speech Coach. Listen to audio. Context: ${speechType}, ${side}, Topic: ${topic}. Evaluate: 1. Vocal Delivery (Pace, Tone, Fluency). 2. Content. 3. Score (0-100).`;
                            payloadParts = [{ text: systemPrompt }, { inlineData: { mimeType: audioData.mimeType, data: audioData.raw } }];
                        }

                        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ contents: [{ parts: payloadParts }] })
                        });

                        if (!response.ok) throw new Error(`Gemini API Error: ${response.statusText}`);
                        const data = await response.json();
                        generatedText = data.candidates?.[0]?.content?.parts?.[0]?.text;

                    } else if (provider === 'openai') {
                        let messages = [];
                        
                        if (isBoardGen) {
                            messages = [{
                                role: "system", content: "You are an expert Debate Coach."
                            }, {
                                role: "user", content: `For the topic "${topic}" and side "${side}" in ${speechType} format, describe an ideal debate board/flow layout. Include strategic grouping, colors, outline, and win conditions. Text description only.`
                            }];
                        } else if (activeTab === 'speech') {
                            messages = [{
                                role: "system", content: "You are an expert Debate Adjudicator."
                            }, {
                                role: "user", content: `Context: ${speechType}, ${side}, Topic: ${topic}. Evaluate this speech. Provide Score (0-100), Summary, Strengths, Weaknesses, Advice. SPEECH: ${transcript}`
                            }];
                        } else if (activeTab === 'board') {
                            const content = [
                                { type: "text", text: `Expert Debate Coach. Evaluate this debate flow/board. Context: ${speechType}, ${side}, Topic: ${topic}. User Notes: ${boardDescription}` }
                            ];
                            boardImages.forEach(img => {
                                content.push({ type: "image_url", image_url: { url: img.url } });
                            });
                            messages = [{ role: "user", content }];
                        }

                        const response = await fetch('https://api.openai.com/v1/chat/completions', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${openaiKey}`
                            },
                            body: JSON.stringify({
                                model: "gpt-4o",
                                messages: messages,
                                max_tokens: 2000
                            })
                        });

                        if (!response.ok) {
                            const errData = await response.json();
                            throw new Error(`OpenAI Error: ${errData.error?.message || response.statusText}`);
                        }
                        const data = await response.json();
                        generatedText = data.choices[0].message.content;
                    }

                    if (generatedText) {
                        setResult(generatedText);
                        addToHistory(generatedText, isBoardGen ? 'Strategy Gen' : activeTab);
                    } else {
                        throw new Error('No analysis returned.');
                    }

                } catch (err) {
                    setError(err.message);
                } finally {
                    setLoading(false);
                }
            };

            // Render UI
            return (
                <div className="min-h-screen bg-slate-50 dark:bg-slate-900 text-slate-900 dark:text-slate-100 font-sans selection:bg-indigo-100 dark:selection:bg-indigo-900 transition-colors duration-200">
                    {/* Header */}
                    <header className="bg-white dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700 sticky top-0 z-10">
                        <div className="max-w-5xl mx-auto px-4 h-16 flex items-center justify-between">
                            <div className="flex items-center space-x-2">
                                <div className="bg-indigo-600 p-2 rounded-lg">
                                    <Gavel className="w-6 h-6 text-white" />
                                </div>
                                <h1 className="text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-indigo-600 to-purple-600 dark:from-indigo-400 dark:to-purple-400">
                                    Adjudicator AI
                                </h1>
                            </div>
                            <div className="flex items-center text-sm text-slate-500 dark:text-slate-400">
                                <div className="flex items-center mr-4 bg-slate-100 dark:bg-slate-700 rounded-full p-1">
                                    <button onClick={() => setTheme('light')} className={`p-1.5 rounded-full transition-all ${theme === 'light' ? 'bg-white shadow text-yellow-500' : 'text-slate-400 hover:text-slate-600'}`} title="Light Mode"><Sun className="w-4 h-4" /></button>
                                    <button onClick={() => setTheme('dark')} className={`p-1.5 rounded-full transition-all ${theme === 'dark' ? 'bg-slate-600 shadow text-indigo-300' : 'text-slate-400 hover:text-slate-600'}`} title="Dark Mode"><Moon className="w-4 h-4" /></button>
                                    <button onClick={() => setTheme('neon')} className={`p-1.5 rounded-full transition-all ${theme === 'neon' ? 'bg-black shadow text-green-400 border border-green-500' : 'text-slate-400 hover:text-slate-600'}`} title="Neon Mode"><Zap className="w-4 h-4" /></button>
                                    <button onClick={() => setTheme('forest')} className={`p-1.5 rounded-full transition-all ${theme === 'forest' ? 'bg-[#1c2321] shadow text-green-300 border border-green-800' : 'text-slate-400 hover:text-slate-600'}`} title="Forest Mode"><Leaf className="w-4 h-4" /></button>
                                    <button onClick={() => setTheme('coffee')} className={`p-1.5 rounded-full transition-all ${theme === 'coffee' ? 'bg-[#2b2118] shadow text-orange-300 border border-orange-800' : 'text-slate-400 hover:text-slate-600'}`} title="Coffee Mode"><Coffee className="w-4 h-4" /></button>
                                </div>
                                {user && (
                                    <div className="flex items-center mr-4">
                                        <span className="hidden sm:inline mr-2 text-xs font-medium">{user.email}</span>
                                        <button onClick={logout} className="p-2 hover:bg-red-100 dark:hover:bg-red-900/30 text-slate-400 hover:text-red-500 rounded-full transition-colors" title="Logout">
                                            <LogOut className="w-4 h-4" />
                                        </button>
                                    </div>
                                )}
                                <button onClick={() => setShowHistory(true)} className="mr-2 p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-full transition-colors" aria-label="History">
                                    <History className="w-5 h-5" />
                                </button>
                                <button onClick={() => setShowHelp(true)} className="mr-2 sm:mr-4 p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-full transition-colors" aria-label="Help">
                                    <HelpCircle className="w-5 h-5" />
                                </button>
                                <span className="hidden sm:inline">Powered by Gemini</span>
                                <Award className="w-4 h-4 ml-1" />
                            </div>
                        </div>
                    </header>

                    <main className="max-w-5xl mx-auto px-4 py-8">
                        {/* API Key */}
                        <div className="mb-8 bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700 overflow-hidden">
                            <div className="bg-slate-100 dark:bg-slate-900/50 px-6 py-3 border-b border-slate-200 dark:border-slate-700 flex items-center">
                                <Settings className="w-4 h-4 mr-2 text-slate-500" />
                                <h2 className="text-sm font-semibold text-slate-700 dark:text-slate-300">Configuration</h2>
                            </div>
                            <div className="p-6">
                                <div className="mb-4">
                                    <label className="block text-sm font-medium mb-2">AI Provider</label>
                                    <div className="flex space-x-4">
                                        <label className="flex items-center cursor-pointer">
                                            <input type="radio" name="provider" value="gemini" checked={provider === 'gemini'} onChange={() => setProvider('gemini')} className="mr-2" />
                                            <span className="text-sm">Google Gemini</span>
                                        </label>
                                        <label className="flex items-center cursor-pointer">
                                            <input type="radio" name="provider" value="openai" checked={provider === 'openai'} onChange={() => setProvider('openai')} className="mr-2" />
                                            <span className="text-sm">OpenAI (GPT-4o)</span>
                                        </label>
                                    </div>
                                </div>

                                {provider === 'gemini' ? (
                                    <div>
                                        <label className="block text-sm font-medium mb-2">Gemini API Key</label>
                                        <input type="password" placeholder="Paste your Gemini API key..." className="w-full px-4 py-2 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 focus:ring-2 focus:ring-indigo-500 outline-none transition-all" value={apiKey} onChange={(e) => setApiKey(e.target.value)} />
                                        <p className="text-xs text-slate-500 dark:text-slate-400 mt-2">
                                            Need a key? <a href="https://aistudio.google.com/app/apikey" target="_blank" rel="noopener noreferrer" className="text-indigo-600 dark:text-indigo-400 hover:underline">Get a free Gemini API key here</a>.
                                        </p>
                                    </div>
                                ) : (
                                    <div>
                                        <label className="block text-sm font-medium mb-2">OpenAI API Key</label>
                                        <input type="password" placeholder="Paste your OpenAI API key..." className="w-full px-4 py-2 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 focus:ring-2 focus:ring-indigo-500 outline-none transition-all" value={openaiKey} onChange={(e) => setOpenaiKey(e.target.value)} />
                                        <p className="text-xs text-slate-500 dark:text-slate-400 mt-2">
                                            Need a key? <a href="https://platform.openai.com/api-keys" target="_blank" rel="noopener noreferrer" className="text-indigo-600 dark:text-indigo-400 hover:underline">Get an OpenAI API key here</a>.
                                        </p>
                                    </div>
                                )}
                            </div>
                        </div>

                        {/* Navigation */}
                        <div className="flex space-x-2 mb-6 bg-slate-200 dark:bg-slate-800 p-1 rounded-lg w-fit overflow-x-auto">
                            {[
                                { id: 'speech', label: 'Judge Text', icon: Mic },
                                { id: 'board', label: 'Evaluate Board', icon: Layout },
                                { id: 'listen', label: 'Live Coach', icon: Activity }
                            ].map(tab => (
                                <button key={tab.id} onClick={() => setActiveTab(tab.id)} className={`flex items-center px-4 py-2 rounded-md text-sm font-medium transition-all whitespace-nowrap ${activeTab === tab.id ? 'bg-white dark:bg-slate-700 text-indigo-600 dark:text-indigo-400 shadow-sm' : 'text-slate-600 dark:text-slate-400 hover:text-slate-900'}`}>
                                    <tab.icon className="w-4 h-4 mr-2" />
                                    {tab.label}
                                </button>
                            ))}
                        </div>

                        <div className="grid md:grid-cols-3 gap-8">
                            {/* Context Panel */}
                            <div className="md:col-span-1 space-y-6">
                                <div className="bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700 p-6">
                                    <div className="flex items-center mb-4 text-indigo-600 dark:text-indigo-400">
                                        <BookOpen className="w-5 h-5 mr-2" />
                                        <h2 className="font-bold">Context</h2>
                                    </div>
                                    <div className="space-y-4">
                                        <div>
                                            <label className="block text-xs font-semibold text-slate-500 uppercase mb-1">Format</label>
                                            <div className="relative">
                                                <select className="w-full appearance-none bg-slate-50 dark:bg-slate-900 border border-slate-300 dark:border-slate-600 text-slate-900 dark:text-slate-100 py-2 px-3 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none" value={speechType} onChange={(e) => setSpeechType(e.target.value)}>
                                                    {speechTypes.map(t => <option key={t} value={t}>{t}</option>)}
                                                </select>
                                                <ChevronDown className="absolute right-3 top-3 w-4 h-4 text-slate-400 pointer-events-none" />
                                            </div>
                                        </div>
                                        <div>
                                            <label className="block text-xs font-semibold text-slate-500 uppercase mb-1">Role</label>
                                            <div className="relative">
                                                <select className="w-full appearance-none bg-slate-50 dark:bg-slate-900 border border-slate-300 dark:border-slate-600 text-slate-900 dark:text-slate-100 py-2 px-3 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none" value={side} onChange={(e) => setSide(e.target.value)}>
                                                    {sides.map(s => <option key={s} value={s}>{s}</option>)}
                                                </select>
                                                <ChevronDown className="absolute right-3 top-3 w-4 h-4 text-slate-400 pointer-events-none" />
                                            </div>
                                        </div>
                                        <div>
                                            <label className="block text-xs font-semibold text-slate-500 uppercase mb-1">Topic</label>
                                            <input type="text" placeholder="Resolved: ..." className="w-full bg-slate-50 dark:bg-slate-900 border border-slate-300 dark:border-slate-600 text-slate-900 dark:text-slate-100 py-2 px-3 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none" value={topic} onChange={(e) => setTopic(e.target.value)} />
                                        </div>
                                    </div>
                                </div>
                            </div>

                            {/* Main Panel */}
                            <div className="md:col-span-2 space-y-6">
                                <div className="bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700 flex flex-col min-h-[24rem]">
                                    <div className="px-6 py-3 border-b border-slate-200 dark:border-slate-700 flex items-center justify-between bg-slate-50 dark:bg-slate-900/50 rounded-t-xl">
                                        <div className="flex items-center text-slate-700 dark:text-slate-300 font-semibold">
                                            {activeTab === 'speech' && <><Mic className="w-4 h-4 mr-2" /> Transcript Input</>}
                                            {activeTab === 'board' && <><ImageIcon className="w-4 h-4 mr-2" /> Board Upload</>}
                                            {activeTab === 'listen' && <><Activity className="w-4 h-4 mr-2" /> Live Audio</>}
                                        </div>
                                    </div>

                                    <div className="flex-1 p-6">
                                        {activeTab === 'speech' && (
                                            <textarea className="w-full h-full min-h-[200px] bg-transparent resize-none outline-none font-mono text-sm" placeholder="Paste speech text here..." value={transcript} onChange={(e) => setTranscript(e.target.value)} />
                                        )}

                                        {activeTab === 'board' && (
                                            <div className="space-y-4 flex flex-col h-full">
                                                {boardImages.length === 0 ? (
                                                    <div className="border-2 border-dashed border-slate-300 dark:border-slate-600 rounded-lg p-8 text-center hover:bg-slate-50 dark:hover:bg-slate-900/50 cursor-pointer" onClick={() => fileInputRef.current?.click()}>
                                                        <Upload className="w-10 h-10 text-slate-400 mb-3 mx-auto" />
                                                        <p className="text-sm text-slate-500">Click to upload Board Images</p>
                                                    </div>
                                                ) : (
                                                    <div className="grid grid-cols-2 sm:grid-cols-3 gap-4">
                                                        {boardImages.map((img, idx) => (
                                                            <div key={img.id} className="relative border border-slate-200 dark:border-slate-700 rounded-lg p-1">
                                                                <div className="absolute top-0 left-0 px-2 py-1 text-xs font-semibold bg-slate-100 dark:bg-slate-900 rounded-br-lg">Board {idx + 1}</div>
                                                                <img src={img.url} alt="" className="w-full h-24 object-cover rounded" />
                                                                <button onClick={() => removeImage(img.id)} className="absolute -top-2 -right-2 bg-red-500 text-white p-1 rounded-full"><X className="w-3 h-3" /></button>
                                                            </div>
                                                        ))}
                                                        <div onClick={() => fileInputRef.current?.click()} className="flex flex-col items-center justify-center h-26 border-2 border-dashed border-slate-300 rounded-lg cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-900/50">
                                                            <Plus className="w-6 h-6 text-slate-400" />
                                                        </div>
                                                    </div>
                                                )}
                                                <input type="file" multiple ref={fileInputRef} className="hidden" accept="image/*" onChange={handleImageUpload} />
                                                <textarea className="w-full h-32 p-3 rounded-lg border border-slate-200 dark:border-slate-600 bg-slate-50 dark:bg-slate-900 resize-none outline-none text-sm" placeholder="Describe board strategy..." value={boardDescription} onChange={(e) => setBoardDescription(e.target.value)} />
                                                <div className="flex justify-end">
                                                    <button onClick={() => handleAnalyze(true)} className="text-xs flex items-center text-indigo-600 dark:text-indigo-400 hover:underline">
                                                        <Lightbulb className="w-3 h-3 mr-1" /> Need ideas? Generate a board strategy
                                                    </button>
                                                </div>
                                            </div>
                                        )}

                                        {activeTab === 'listen' && (
                                            <div className="h-full flex flex-col items-center justify-center space-y-8 py-8">
                                                <div className="text-center">
                                                    <h3 className="text-2xl font-mono font-bold text-slate-700 dark:text-slate-200">{formatTime(recordingTime)}</h3>
                                                    <p className="text-sm text-slate-500 mt-2">{isRecording ? 'Recording...' : audioData ? 'Ready for analysis' : 'Ready to record'}</p>
                                                </div>
                                                <div className="relative group">
                                                    {isRecording && <div className="absolute inset-0 bg-red-500 rounded-full animate-ping opacity-20"></div>}
                                                    {!isRecording ? (
                                                        <button onClick={startRecording} className="relative z-10 w-20 h-20 bg-indigo-600 hover:bg-indigo-700 text-white rounded-full flex items-center justify-center shadow-lg transform hover:scale-105 transition-all">
                                                            <Mic className="w-8 h-8" />
                                                        </button>
                                                    ) : (
                                                        <button onClick={stopRecording} className="relative z-10 w-20 h-20 bg-red-500 hover:bg-red-600 text-white rounded-full flex items-center justify-center shadow-lg transform hover:scale-105 transition-all">
                                                            <Square className="w-8 h-8 fill-current" />
                                                        </button>
                                                    )}
                                                </div>
                                                {audioData && !isRecording && (
                                                    <div className="flex items-center space-x-4 animate-in fade-in slide-in-from-bottom-4">
                                                        <div className="flex items-center px-4 py-2 bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-300 rounded-full border border-green-200 dark:border-green-800 text-sm font-medium">
                                                            <CheckCircle2 className="w-4 h-4 mr-2" /> Saved
                                                        </div>
                                                        <button onClick={resetAudio} className="text-sm text-slate-500 hover:text-slate-700 underline">Retry</button>
                                                    </div>
                                                )}
                                            </div>
                                        )}
                                    </div>

                                    <div className="p-4 border-t border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900/50 rounded-b-xl flex justify-end">
                                        <button onClick={() => handleAnalyze(false)} disabled={loading} className={`flex items-center px-6 py-2.5 rounded-lg font-medium text-white shadow-md transition-all ${loading ? 'bg-slate-400 cursor-not-allowed' : 'bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700'}`}>
                                            {loading ? <><Loader2 className="w-4 h-4 mr-2 animate-spin" /> Analyzing...</> : <><Send className="w-4 h-4 mr-2" /> Analyze</>}
                                        </button>
                                    </div>
                                </div>

                                {error && (
                                    <div className="bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 text-red-700 dark:text-red-300 p-4 rounded-lg flex items-center">
                                        <AlertCircle className="w-5 h-5 mr-3 flex-shrink-0" /> {error}
                                    </div>
                                )}

                                {result && (
                                    <div className="bg-white dark:bg-slate-800 rounded-xl shadow-lg border border-indigo-100 dark:border-slate-700 overflow-hidden animate-in fade-in slide-in-from-bottom-4">
                                        <div className="bg-gradient-to-r from-indigo-600 to-purple-600 px-6 py-4 flex items-center text-white">
                                            <CheckCircle2 className="w-6 h-6 mr-3" />
                                            <h2 className="font-bold text-lg">Result</h2>
                                        </div>
                                        <div className="p-8 bg-slate-50/50 dark:bg-slate-800">
                                            <MarkdownRenderer content={result} />
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    </main>

                    {/* Login Modal */}
                    {showLogin && (
                        <div className="fixed inset-0 z-[60] flex items-center justify-center p-4 bg-slate-900/80 backdrop-blur-sm animate-in fade-in">
                            <div className="bg-white dark:bg-slate-800 rounded-2xl shadow-2xl max-w-md w-full overflow-hidden border border-slate-200 dark:border-slate-700">
                                <div className="p-8">
                                    <div className="flex justify-center mb-6">
                                        <div className="bg-indigo-600 p-3 rounded-xl shadow-lg shadow-indigo-500/30">
                                            <Gavel className="w-8 h-8 text-white" />
                                        </div>
                                    </div>
                                    <h2 className="text-2xl font-bold text-center text-slate-900 dark:text-white mb-2">
                                        {authMode === 'login' ? 'Welcome Back' : 'Create Account'}
                                    </h2>
                                    <p className="text-center text-slate-500 dark:text-slate-400 mb-8 text-sm">
                                        {authMode === 'login' ? 'Sign in to access your debate history' : 'Sign up to start tracking your progress'}
                                    </p>

                                    <form onSubmit={handleAuth} className="space-y-4">
                                        <div>
                                            <label className="block text-xs font-semibold text-slate-500 uppercase mb-1">Email</label>
                                            <div className="relative">
                                                <User className="absolute left-3 top-2.5 w-4 h-4 text-slate-400" />
                                                <input 
                                                    type="email" 
                                                    required
                                                    className="w-full pl-10 pr-4 py-2 rounded-lg border border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-900 focus:ring-2 focus:ring-indigo-500 outline-none transition-all" 
                                                    placeholder="name@example.com"
                                                    value={authEmail}
                                                    onChange={(e) => setAuthEmail(e.target.value)}
                                                />
                                            </div>
                                        </div>
                                        <div>
                                            <label className="block text-xs font-semibold text-slate-500 uppercase mb-1">Password</label>
                                            <div className="relative">
                                                <Lock className="absolute left-3 top-2.5 w-4 h-4 text-slate-400" />
                                                <input 
                                                    type="password" 
                                                    required
                                                    className="w-full pl-10 pr-4 py-2 rounded-lg border border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-900 focus:ring-2 focus:ring-indigo-500 outline-none transition-all" 
                                                    placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
                                                    value={authPassword}
                                                    onChange={(e) => setAuthPassword(e.target.value)}
                                                />
                                            </div>
                                        </div>

                                        {authError && (
                                            <div className="text-red-500 text-xs text-center bg-red-50 dark:bg-red-900/20 p-2 rounded">
                                                {authError}
                                            </div>
                                        )}

                                        <button type="submit" className="w-full py-2.5 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg font-medium transition-colors shadow-lg shadow-indigo-500/30">
                                            {authMode === 'login' ? 'Sign In' : 'Create Account'}
                                        </button>
                                    </form>

                                    <div className="mt-6 text-center text-sm text-slate-500">
                                        {authMode === 'login' ? (
                                            <>Don't have an account? <button onClick={() => setAuthMode('signup')} className="text-indigo-600 hover:underline font-medium">Sign up</button></>
                                        ) : (
                                            <>Already have an account? <button onClick={() => setAuthMode('login')} className="text-indigo-600 hover:underline font-medium">Sign in</button></>
                                        )}
                                    </div>
                                    
                                    <div className="mt-6 pt-6 border-t border-slate-100 dark:border-slate-700 text-center">
                                        <p className="text-xs text-slate-400">
                                            {isFirebaseReady ? 'Secure Cloud Authentication' : 'Demo Mode: Data stored locally'}
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* History Modal */}
                    {showHistory && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm animate-in fade-in">
                            <div className="bg-white dark:bg-slate-800 rounded-2xl shadow-2xl max-w-2xl w-full overflow-hidden border border-slate-200 dark:border-slate-700 flex flex-col max-h-[90vh]">
                                <div className="p-6 border-b border-slate-200 dark:border-slate-700 flex justify-between items-center">
                                    <h3 className="text-xl font-bold text-slate-900 dark:text-white flex items-center">
                                        <History className="w-5 h-5 mr-2" /> History
                                    </h3>
                                    <div className="flex items-center space-x-2">
                                        {history.length > 0 && (
                                            <button onClick={clearHistory} className="text-red-500 hover:text-red-700 text-sm flex items-center px-3 py-1 rounded hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors">
                                                <Trash2 className="w-4 h-4 mr-1" /> Clear
                                            </button>
                                        )}
                                        <button onClick={() => setShowHistory(false)} className="text-slate-400 hover:text-slate-600 dark:hover:text-slate-200">
                                            <X className="w-6 h-6" />
                                        </button>
                                    </div>
                                </div>
                                <div className="flex-1 overflow-y-auto p-6 space-y-4">
                                    {history.length === 0 ? (
                                        <div className="text-center text-slate-500 py-10">
                                            <History className="w-12 h-12 mx-auto mb-3 opacity-20" />
                                            <p>No history yet. Analyze something to see it here!</p>
                                        </div>
                                    ) : (
                                        history.map(item => (
                                            <div key={item.id} className="bg-slate-50 dark:bg-slate-900/50 rounded-lg p-4 border border-slate-200 dark:border-slate-700 hover:border-indigo-300 dark:hover:border-indigo-700 transition-colors">
                                                <div className="flex justify-between items-start mb-2">
                                                    <div>
                                                        <span className="text-xs font-bold uppercase tracking-wider text-indigo-600 dark:text-indigo-400 bg-indigo-50 dark:bg-indigo-900/30 px-2 py-0.5 rounded">{item.type}</span>
                                                        <h4 className="font-semibold text-slate-800 dark:text-slate-200 mt-1">{item.topic}</h4>
                                                        <span className="text-xs text-slate-400">{item.date}</span>
                                                    </div>
                                                    <div className="flex space-x-1">
                                                        <button onClick={() => { setResult(item.content); setShowHistory(false); }} className="p-1.5 text-slate-500 hover:text-indigo-600 hover:bg-indigo-50 dark:hover:bg-indigo-900/30 rounded transition-colors" title="View">
                                                            <Layout className="w-4 h-4" />
                                                        </button>
                                                        <button onClick={() => navigator.clipboard.writeText(item.content)} className="p-1.5 text-slate-500 hover:text-green-600 hover:bg-green-50 dark:hover:bg-green-900/30 rounded transition-colors" title="Copy">
                                                            <Copy className="w-4 h-4" />
                                                        </button>
                                                    </div>
                                                </div>
                                                <div className="text-xs text-slate-500 dark:text-slate-400 line-clamp-2">
                                                    {item.content.substring(0, 150)}...
                                                </div>
                                            </div>
                                        ))
                                    )}
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Help Modal */}
                    {showHelp && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm animate-in fade-in">
                            <div className="bg-white dark:bg-slate-800 rounded-2xl shadow-2xl max-w-lg w-full overflow-hidden border border-slate-200 dark:border-slate-700 flex flex-col max-h-[90vh]">
                                <div className="p-6 overflow-y-auto">
                                    <div className="flex justify-between items-center mb-4">
                                        <h3 className="text-xl font-bold text-slate-900 dark:text-white">Welcome to Adjudicator AI</h3>
                                        <button onClick={() => setShowHelp(false)} className="text-slate-400 hover:text-slate-600 dark:hover:text-slate-200">
                                            <X className="w-6 h-6" />
                                        </button>
                                    </div>
                                    <div className="space-y-4 text-slate-600 dark:text-slate-300 text-sm">
                                        <p>Your personal AI debate coach and adjudicator. Here's how to use it:</p>
                                        <ul className="space-y-3">
                                            <li className="flex items-start">
                                                <div className="bg-indigo-100 dark:bg-indigo-900/30 p-2 rounded-lg mr-3 mt-0.5 flex-shrink-0">
                                                    <Mic className="w-4 h-4 text-indigo-600 dark:text-indigo-400" />
                                                </div>
                                                <div>
                                                    <strong className="block text-slate-800 dark:text-slate-200">Judge Text</strong>
                                                    Paste your speech transcript to get a score and detailed feedback.
                                                </div>
                                            </li>
                                            <li className="flex items-start">
                                                <div className="bg-purple-100 dark:bg-purple-900/30 p-2 rounded-lg mr-3 mt-0.5 flex-shrink-0">
                                                    <Layout className="w-4 h-4 text-purple-600 dark:text-purple-400" />
                                                </div>
                                                <div>
                                                    <strong className="block text-slate-800 dark:text-slate-200">Evaluate Board</strong>
                                                    Upload photos of your flow/board for strategy and organization tips.
                                                </div>
                                            </li>
                                            <li className="flex items-start">
                                                <div className="bg-pink-100 dark:bg-pink-900/30 p-2 rounded-lg mr-3 mt-0.5 flex-shrink-0">
                                                    <Activity className="w-4 h-4 text-pink-600 dark:text-pink-400" />
                                                </div>
                                                <div>
                                                    <strong className="block text-slate-800 dark:text-slate-200">Live Coach</strong>
                                                    Record your speech audio for delivery and content analysis.
                                                </div>
                                            </li>
                                        </ul>
                                        <div className="mt-4 p-3 bg-slate-100 dark:bg-slate-900 rounded-lg text-xs text-slate-500">
                                            <strong>Note:</strong> You'll need a Gemini API key to start. Enter it in the Configuration section.
                                        </div>
                                    </div>
                                </div>
                                <div className="p-4 bg-slate-50 dark:bg-slate-900/50 border-t border-slate-200 dark:border-slate-700 flex justify-end flex-shrink-0">
                                    <button onClick={() => setShowHelp(false)} className="px-6 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg font-medium transition-colors w-full sm:w-auto">
                                        Get Started
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>