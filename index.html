<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adjudicator AI</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Tailwind Configuration for Dark Mode -->
    <script>
        tailwind.config = {
            darkMode: 'class', // or 'media'
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                },
            },
        }
    </script>

    <!-- React & ReactDOM via ESM -->
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "lucide-react": "https://esm.sh/lucide-react@0.263.1"
      }
    }
    </script>
    
    <!-- Babel for JSX translation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { font-family: 'Inter', sans-serif; }
        /* Hide scrollbar for cleaner UI */
        textarea::-webkit-scrollbar { width: 8px; }
        textarea::-webkit-scrollbar-track { background: transparent; }
        textarea::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 20px; }

        /* Neon Theme Overrides */
        .theme-neon body { background-color: #050505 !important; color: #00ff41 !important; font-family: 'Courier New', monospace; }
        .theme-neon .bg-white, .theme-neon .bg-slate-50, .theme-neon .bg-slate-100, .theme-neon .bg-slate-200, .theme-neon .bg-slate-800, .theme-neon .bg-slate-900 {
            background-color: #0a0a0a !important;
            border-color: #ff00ff !important;
            color: #00ff41 !important;
        }
        .theme-neon header, .theme-neon .bg-white { background-color: #000 !important; border-bottom: 1px solid #00ff41 !important; }
        .theme-neon .text-slate-900, .theme-neon .text-slate-700, .theme-neon .text-slate-500, .theme-neon .text-slate-400 {
            color: #00ff41 !important;
        }
        .theme-neon .text-indigo-600, .theme-neon .text-indigo-500, .theme-neon .text-purple-600 {
            color: #ff00ff !important;
            text-shadow: 0 0 5px #ff00ff;
        }
        .theme-neon button {
            border: 1px solid #00ff41 !important;
            box-shadow: 0 0 5px #00ff41;
        }
        .theme-neon input, .theme-neon select, .theme-neon textarea {
            background-color: #000 !important;
            border: 1px solid #00ff41 !important;
            color: #00ff41 !important;
        }
        .theme-neon .bg-indigo-600 {
            background-color: #000 !important;
            border: 1px solid #ff00ff !important;
            color: #ff00ff !important;
            box-shadow: 0 0 10px #ff00ff;
        }
        .theme-neon .bg-gradient-to-r {
            background: #000 !important;
            border: 1px solid #00ff41 !important;
            box-shadow: 0 0 10px #00ff41;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 dark:bg-slate-900 dark:text-slate-100">
    
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useRef, useEffect } from 'react';
        import { createRoot } from 'react-dom/client';
        import { 
            Gavel, 
            Mic, 
            Settings, 
            AlertCircle, 
            CheckCircle2, 
            ChevronDown, 
            Send, 
            Loader2, 
            Award, 
            BookOpen, 
            Layout, 
            Image as ImageIcon, 
            Upload, 
            X, 
            Plus, 
            Square, 
            Activity,
            HelpCircle,
            Palette,
            Lightbulb,
            Moon,
            Sun,
            Zap
        } from 'lucide-react';

        // --- Components ---

        const MarkdownRenderer = ({ content }) => {
            if (!content) return null;

            const parseInline = (text) => {
                const parts = text.split(/(\*\*.*?\*\*)/g);
                return parts.map((part, index) => {
                    if (part.startsWith('**') && part.endsWith('**')) {
                        return <strong key={index} className="font-bold text-indigo-700 dark:text-indigo-300">{part.slice(2, -2)}</strong>;
                    }
                    return part;
                });
            };
            
            const lines = content.split('\n');
            
            return (
                <div className="space-y-2 text-slate-700 dark:text-slate-300 leading-relaxed">
                {lines.map((line, i) => {
                    if (line.startsWith('#### ')) {
                        return <h4 key={i} className="text-md font-bold text-slate-800 dark:text-slate-200 mt-4 mb-2">{parseInline(line.replace('#### ', ''))}</h4>;
                    }
                    if (line.startsWith('### ')) {
                        return <h3 key={i} className="text-lg font-semibold text-slate-800 dark:text-slate-200 mt-4 mb-2">{parseInline(line.replace('### ', ''))}</h3>;
                    }
                    if (line.startsWith('## ')) {
                        return <h2 key={i} className="text-xl font-bold text-indigo-600 dark:text-indigo-400 mt-6 mb-3 border-b border-slate-200 dark:border-slate-700 pb-2">{parseInline(line.replace('## ', ''))}</h2>;
                    }
                    if (line.trim().startsWith('* ') || line.trim().startsWith('- ')) {
                        return (
                            <div key={i} className="flex items-start space-x-2 ml-4">
                                <span className="text-indigo-500 mt-1.5">â€¢</span>
                                <span>{parseInline(line.replace(/^[\*\-]\s/, ''))}</span>
                            </div>
                        );
                    }
                    if (line.trim() === '') return <div key={i} className="h-2"></div>;
                    
                    return <p key={i}>{parseInline(line)}</p>;
                })}
                </div>
            );
        };

        function App() {
            // State Management
            const [activeTab, setActiveTab] = useState('speech'); 
            const [apiKey, setApiKey] = useState('');
            const [loading, setLoading] = useState(false);
            const [result, setResult] = useState(null);
            const [error, setError] = useState('');
            const [showHelp, setShowHelp] = useState(false);
            const [theme, setTheme] = useState('light'); // light, dark, neon

            useEffect(() => {
                const savedTheme = localStorage.getItem('theme') || 'light';
                setTheme(savedTheme);
            }, []);

            useEffect(() => {
                const root = document.documentElement;
                const body = document.body;
                
                // Reset
                root.classList.remove('dark');
                body.classList.remove('theme-neon');
                
                if (theme === 'dark') {
                    root.classList.add('dark');
                } else if (theme === 'neon') {
                    root.classList.add('dark'); // Neon builds on dark
                    body.classList.add('theme-neon');
                }
                
                localStorage.setItem('theme', theme);
            }, [theme]);

            useEffect(() => {
                const hasVisited = localStorage.getItem('hasVisited');
                if (!hasVisited) {
                    setShowHelp(true);
                    localStorage.setItem('hasVisited', 'true');
                }
            }, []);
            
            // Speech Form State
            const [speechType, setSpeechType] = useState('Public Forum (PF)');
            const [side, setSide] = useState('Proposition/Affirmative');
            const [topic, setTopic] = useState('');
            const [transcript, setTranscript] = useState('');

            // Board Form State
            const [boardDescription, setBoardDescription] = useState('');
            const [boardImages, setBoardImages] = useState([]); 
            const fileInputRef = useRef(null);

            // Audio Recording State
            const [isRecording, setIsRecording] = useState(false);
            const [recordingTime, setRecordingTime] = useState(0);
            const [audioData, setAudioData] = useState(null); 
            const mediaRecorderRef = useRef(null);
            const timerRef = useRef(null);
            const chunksRef = useRef([]);

            // Options
            const speechTypes = [
                'Policy Debate (CX)', 'Lincoln-Douglas (LD)', 'Public Forum (PF)', 'Big Questions Debate',
                'World Schools Debate', 'Congressional Debate', 'Original Oratory (OO)', 'Informative Speaking (INFO)',
                'United States Extemp (USX)', 'International Extemp (IX)', 'Dramatic Interpretation (DI)',
                'Humorous Interpretation (HI)', 'Duo Interpretation', 'Program Oral Interpretation (POI)',
                'Impromptu', 'Extemporaneous Commentary', 'Expository', 'Storytelling', 'Prose/Poetry',
                'Parliamentary (British)', 'Parliamentary (Asian)', 'Model UN Speech', 'After Dinner Speaking', 'Toast/Ceremonial'
            ];

            const sides = [
                'Proposition/Affirmative', 'Opposition/Negative', 'Government', 'Opposition',
                'Pro', 'Con', 'Opening Member', 'Closing Member/Whip', 'Sponsor (Congress)',
                'Individual/Solo', 'Neutral/Evaluator'
            ];

            // Handlers
            const handleImageUpload = (e) => {
                const files = Array.from(e.target.files);
                if (files.length === 0) return;
                files.forEach(file => {
                    if (file.size > 4 * 1024 * 1024) {
                        setError(prev => (prev ? `${prev} ` : '') + `Skipped ${file.name} (too large).`);
                        return;
                    }
                    const reader = new FileReader();
                    reader.onloadend = () => {
                        const base64String = reader.result.split(',')[1];
                        setBoardImages(prev => [...prev, {
                            id: Math.random().toString(36).substr(2, 9),
                            url: reader.result,
                            raw: base64String,
                            mimeType: file.type,
                            name: file.name
                        }]);
                    };
                    reader.readAsDataURL(file);
                });
                if (fileInputRef.current) fileInputRef.current.value = '';
            };

            const removeImage = (id) => {
                setBoardImages(prev => prev.filter(img => img.id !== id));
            };

            const formatTime = (seconds) => {
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
            };

            const startRecording = async () => {
                setError('');
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    mediaRecorderRef.current = new MediaRecorder(stream);
                    chunksRef.current = [];
                    mediaRecorderRef.current.ondataavailable = (e) => {
                        if (e.data.size > 0) chunksRef.current.push(e.data);
                    };
                    mediaRecorderRef.current.onstop = () => {
                        const blob = new Blob(chunksRef.current, { type: 'audio/webm' });
                        const reader = new FileReader();
                        reader.readAsDataURL(blob);
                        reader.onloadend = () => {
                            const base64String = reader.result.split(',')[1];
                            setAudioData({ raw: base64String, mimeType: blob.type });
                        };
                        stream.getTracks().forEach(track => track.stop());
                    };
                    mediaRecorderRef.current.start();
                    setIsRecording(true);
                    setRecordingTime(0);
                    setAudioData(null);
                    timerRef.current = setInterval(() => setRecordingTime(prev => prev + 1), 1000);
                } catch (err) {
                    setError("Could not access microphone. Ensure permissions are granted (may require HTTPS or localhost).");
                    console.error(err);
                }
            };

            const stopRecording = () => {
                if (mediaRecorderRef.current && isRecording) {
                    mediaRecorderRef.current.stop();
                    setIsRecording(false);
                    clearInterval(timerRef.current);
                }
            };

            const resetAudio = () => {
                setAudioData(null);
                setRecordingTime(0);
                setError('');
            };

            const handleAnalyze = async (isBoardGen = false) => {
                if (!apiKey) { setError('Please enter a valid Gemini API Key.'); return; }
                if (!isBoardGen) {
                    if (activeTab === 'speech' && !transcript) { setError('Please enter speech text.'); return; }
                    if (activeTab === 'board' && !boardDescription && boardImages.length === 0) { setError('Please provide images or description.'); return; }
                    if (activeTab === 'listen' && !audioData) { setError('Please record audio first.'); return; }
                }
                
                setLoading(true);
                setError('');
                setResult(null);

                try {
                    let payloadParts = [];
                    let systemPrompt = '';
                    
                    // Prompt Construction
                    if (isBoardGen) {
                         systemPrompt = `Act as an expert Debate Coach. For the topic "${topic}" and side "${side}" in ${speechType} format, describe an ideal debate board/flow layout. 
                         Include:
                         1. Strategic grouping of arguments.
                         2. How to use colors/columns effectively.
                         3. A text-based outline of the main content blocks.
                         4. Key "win conditions" to highlight on the board.
                         Do NOT generate an image, just a detailed text description.`;
                         payloadParts = [{ text: systemPrompt }];
                    } else if (activeTab === 'speech') {
                        systemPrompt = `You are an expert Debate Adjudicator. Context: ${speechType}, ${side}, Topic: ${topic}. Evaluate the speech text. Provide Score (0-100), Summary, Strengths, Weaknesses, Advice. SPEECH: ${transcript}`;
                        payloadParts = [{ text: systemPrompt }];
                    } else if (activeTab === 'board') {
                        systemPrompt = `Expert Debate Coach (Flowing). Evaluate board/flow. Context: ${speechType}, ${side}, Topic: ${topic}. Assess Organization, Grouping, Legibility, Suggestions. User Notes: ${boardDescription}`;
                        payloadParts = [{ text: systemPrompt }];
                        boardImages.forEach(img => payloadParts.push({ inlineData: { mimeType: img.mimeType, data: img.raw } }));
                    } else if (activeTab === 'listen') {
                        systemPrompt = `Expert Speech Coach. Listen to audio. Context: ${speechType}, ${side}, Topic: ${topic}. Evaluate: 1. Vocal Delivery (Pace, Tone, Fluency). 2. Content. 3. Score (0-100).`;
                        payloadParts = [{ text: systemPrompt }, { inlineData: { mimeType: audioData.mimeType, data: audioData.raw } }];
                    }

                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ contents: [{ parts: payloadParts }] })
                    });

                    if (!response.ok) throw new Error(`API Error: ${response.statusText}`);
                    const data = await response.json();
                    const generatedText = data.candidates?.[0]?.content?.parts?.[0]?.text;
                    if (generatedText) setResult(generatedText);
                    else throw new Error('No analysis returned.');

                } catch (err) {
                    setError(err.message);
                } finally {
                    setLoading(false);
                }
            };

            // Render UI
            return (
                <div className="min-h-screen bg-slate-50 dark:bg-slate-900 text-slate-900 dark:text-slate-100 font-sans selection:bg-indigo-100 dark:selection:bg-indigo-900 transition-colors duration-200">
                    {/* Header */}
                    <header className="bg-white dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700 sticky top-0 z-10">
                        <div className="max-w-5xl mx-auto px-4 h-16 flex items-center justify-between">
                            <div className="flex items-center space-x-2">
                                <div className="bg-indigo-600 p-2 rounded-lg">
                                    <Gavel className="w-6 h-6 text-white" />
                                </div>
                                <h1 className="text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-indigo-600 to-purple-600 dark:from-indigo-400 dark:to-purple-400">
                                    Adjudicator AI
                                </h1>
                            </div>
                            <div className="flex items-center text-sm text-slate-500 dark:text-slate-400">
                                <div className="flex items-center mr-4 bg-slate-100 dark:bg-slate-700 rounded-full p-1">
                                    <button onClick={() => setTheme('light')} className={`p-1.5 rounded-full transition-all ${theme === 'light' ? 'bg-white shadow text-yellow-500' : 'text-slate-400 hover:text-slate-600'}`} title="Light Mode"><Sun className="w-4 h-4" /></button>
                                    <button onClick={() => setTheme('dark')} className={`p-1.5 rounded-full transition-all ${theme === 'dark' ? 'bg-slate-600 shadow text-indigo-300' : 'text-slate-400 hover:text-slate-600'}`} title="Dark Mode"><Moon className="w-4 h-4" /></button>
                                    <button onClick={() => setTheme('neon')} className={`p-1.5 rounded-full transition-all ${theme === 'neon' ? 'bg-black shadow text-green-400 border border-green-500' : 'text-slate-400 hover:text-slate-600'}`} title="Neon Mode"><Zap className="w-4 h-4" /></button>
                                </div>
                                <button onClick={() => setShowHelp(true)} className="mr-2 sm:mr-4 p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-full transition-colors" aria-label="Help">
                                    <HelpCircle className="w-5 h-5" />
                                </button>
                                <span className="hidden sm:inline">Powered by Gemini</span>
                                <Award className="w-4 h-4 ml-1" />
                            </div>
                        </div>
                    </header>

                    <main className="max-w-5xl mx-auto px-4 py-8">
                        {/* API Key */}
                        <div className="mb-8 bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700 overflow-hidden">
                            <div className="bg-slate-100 dark:bg-slate-900/50 px-6 py-3 border-b border-slate-200 dark:border-slate-700 flex items-center">
                                <Settings className="w-4 h-4 mr-2 text-slate-500" />
                                <h2 className="text-sm font-semibold text-slate-700 dark:text-slate-300">Configuration</h2>
                            </div>
                            <div className="p-6">
                                <label className="block text-sm font-medium mb-2">Gemini API Key</label>
                                <input type="password" placeholder="Paste your API key here..." className="w-full px-4 py-2 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 focus:ring-2 focus:ring-indigo-500 outline-none transition-all" value={apiKey} onChange={(e) => setApiKey(e.target.value)} />
                                <p className="text-xs text-slate-500 dark:text-slate-400 mt-2">
                                    Need a key? <a href="https://aistudio.google.com/app/apikey" target="_blank" rel="noopener noreferrer" className="text-indigo-600 dark:text-indigo-400 hover:underline">Get a free Gemini API key here</a>.
                                </p>
                            </div>
                        </div>

                        {/* Navigation */}
                        <div className="flex space-x-2 mb-6 bg-slate-200 dark:bg-slate-800 p-1 rounded-lg w-fit overflow-x-auto">
                            {[
                                { id: 'speech', label: 'Judge Text', icon: Mic },
                                { id: 'board', label: 'Evaluate Board', icon: Layout },
                                { id: 'listen', label: 'Live Coach', icon: Activity }
                            ].map(tab => (
                                <button key={tab.id} onClick={() => setActiveTab(tab.id)} className={`flex items-center px-4 py-2 rounded-md text-sm font-medium transition-all whitespace-nowrap ${activeTab === tab.id ? 'bg-white dark:bg-slate-700 text-indigo-600 dark:text-indigo-400 shadow-sm' : 'text-slate-600 dark:text-slate-400 hover:text-slate-900'}`}>
                                    <tab.icon className="w-4 h-4 mr-2" />
                                    {tab.label}
                                </button>
                            ))}
                        </div>

                        <div className="grid md:grid-cols-3 gap-8">
                            {/* Context Panel */}
                            <div className="md:col-span-1 space-y-6">
                                <div className="bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700 p-6">
                                    <div className="flex items-center mb-4 text-indigo-600 dark:text-indigo-400">
                                        <BookOpen className="w-5 h-5 mr-2" />
                                        <h2 className="font-bold">Context</h2>
                                    </div>
                                    <div className="space-y-4">
                                        <div>
                                            <label className="block text-xs font-semibold text-slate-500 uppercase mb-1">Format</label>
                                            <div className="relative">
                                                <select className="w-full appearance-none bg-slate-50 dark:bg-slate-900 border border-slate-300 dark:border-slate-600 text-slate-900 dark:text-slate-100 py-2 px-3 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none" value={speechType} onChange={(e) => setSpeechType(e.target.value)}>
                                                    {speechTypes.map(t => <option key={t} value={t}>{t}</option>)}
                                                </select>
                                                <ChevronDown className="absolute right-3 top-3 w-4 h-4 text-slate-400 pointer-events-none" />
                                            </div>
                                        </div>
                                        <div>
                                            <label className="block text-xs font-semibold text-slate-500 uppercase mb-1">Role</label>
                                            <div className="relative">
                                                <select className="w-full appearance-none bg-slate-50 dark:bg-slate-900 border border-slate-300 dark:border-slate-600 text-slate-900 dark:text-slate-100 py-2 px-3 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none" value={side} onChange={(e) => setSide(e.target.value)}>
                                                    {sides.map(s => <option key={s} value={s}>{s}</option>)}
                                                </select>
                                                <ChevronDown className="absolute right-3 top-3 w-4 h-4 text-slate-400 pointer-events-none" />
                                            </div>
                                        </div>
                                        <div>
                                            <label className="block text-xs font-semibold text-slate-500 uppercase mb-1">Topic</label>
                                            <input type="text" placeholder="Resolved: ..." className="w-full bg-slate-50 dark:bg-slate-900 border border-slate-300 dark:border-slate-600 text-slate-900 dark:text-slate-100 py-2 px-3 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none" value={topic} onChange={(e) => setTopic(e.target.value)} />
                                        </div>
                                    </div>
                                </div>
                            </div>

                            {/* Main Panel */}
                            <div className="md:col-span-2 space-y-6">
                                <div className="bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700 flex flex-col min-h-[24rem]">
                                    <div className="px-6 py-3 border-b border-slate-200 dark:border-slate-700 flex items-center justify-between bg-slate-50 dark:bg-slate-900/50 rounded-t-xl">
                                        <div className="flex items-center text-slate-700 dark:text-slate-300 font-semibold">
                                            {activeTab === 'speech' && <><Mic className="w-4 h-4 mr-2" /> Transcript Input</>}
                                            {activeTab === 'board' && <><ImageIcon className="w-4 h-4 mr-2" /> Board Upload</>}
                                            {activeTab === 'listen' && <><Activity className="w-4 h-4 mr-2" /> Live Audio</>}
                                        </div>
                                    </div>

                                    <div className="flex-1 p-6">
                                        {activeTab === 'speech' && (
                                            <textarea className="w-full h-full min-h-[200px] bg-transparent resize-none outline-none font-mono text-sm" placeholder="Paste speech text here..." value={transcript} onChange={(e) => setTranscript(e.target.value)} />
                                        )}

                                        {activeTab === 'board' && (
                                            <div className="space-y-4 flex flex-col h-full">
                                                {boardImages.length === 0 ? (
                                                    <div className="border-2 border-dashed border-slate-300 dark:border-slate-600 rounded-lg p-8 text-center hover:bg-slate-50 dark:hover:bg-slate-900/50 cursor-pointer" onClick={() => fileInputRef.current?.click()}>
                                                        <Upload className="w-10 h-10 text-slate-400 mb-3 mx-auto" />
                                                        <p className="text-sm text-slate-500">Click to upload Board Images</p>
                                                    </div>
                                                ) : (
                                                    <div className="grid grid-cols-2 sm:grid-cols-3 gap-4">
                                                        {boardImages.map((img, idx) => (
                                                            <div key={img.id} className="relative border border-slate-200 dark:border-slate-700 rounded-lg p-1">
                                                                <div className="absolute top-0 left-0 px-2 py-1 text-xs font-semibold bg-slate-100 dark:bg-slate-900 rounded-br-lg">Board {idx + 1}</div>
                                                                <img src={img.url} alt="" className="w-full h-24 object-cover rounded" />
                                                                <button onClick={() => removeImage(img.id)} className="absolute -top-2 -right-2 bg-red-500 text-white p-1 rounded-full"><X className="w-3 h-3" /></button>
                                                            </div>
                                                        ))}
                                                        <div onClick={() => fileInputRef.current?.click()} className="flex flex-col items-center justify-center h-26 border-2 border-dashed border-slate-300 rounded-lg cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-900/50">
                                                            <Plus className="w-6 h-6 text-slate-400" />
                                                        </div>
                                                    </div>
                                                )}
                                                <input type="file" multiple ref={fileInputRef} className="hidden" accept="image/*" onChange={handleImageUpload} />
                                                <textarea className="w-full h-32 p-3 rounded-lg border border-slate-200 dark:border-slate-600 bg-slate-50 dark:bg-slate-900 resize-none outline-none text-sm" placeholder="Describe board strategy..." value={boardDescription} onChange={(e) => setBoardDescription(e.target.value)} />
                                                <div className="flex justify-end">
                                                    <button onClick={() => handleAnalyze(true)} className="text-xs flex items-center text-indigo-600 dark:text-indigo-400 hover:underline">
                                                        <Lightbulb className="w-3 h-3 mr-1" /> Need ideas? Generate a board strategy
                                                    </button>
                                                </div>
                                            </div>
                                        )}

                                        {activeTab === 'listen' && (
                                            <div className="h-full flex flex-col items-center justify-center space-y-8 py-8">
                                                <div className="text-center">
                                                    <h3 className="text-2xl font-mono font-bold text-slate-700 dark:text-slate-200">{formatTime(recordingTime)}</h3>
                                                    <p className="text-sm text-slate-500 mt-2">{isRecording ? 'Recording...' : audioData ? 'Ready for analysis' : 'Ready to record'}</p>
                                                </div>
                                                <div className="relative group">
                                                    {isRecording && <div className="absolute inset-0 bg-red-500 rounded-full animate-ping opacity-20"></div>}
                                                    {!isRecording ? (
                                                        <button onClick={startRecording} className="relative z-10 w-20 h-20 bg-indigo-600 hover:bg-indigo-700 text-white rounded-full flex items-center justify-center shadow-lg transform hover:scale-105 transition-all">
                                                            <Mic className="w-8 h-8" />
                                                        </button>
                                                    ) : (
                                                        <button onClick={stopRecording} className="relative z-10 w-20 h-20 bg-red-500 hover:bg-red-600 text-white rounded-full flex items-center justify-center shadow-lg transform hover:scale-105 transition-all">
                                                            <Square className="w-8 h-8 fill-current" />
                                                        </button>
                                                    )}
                                                </div>
                                                {audioData && !isRecording && (
                                                    <div className="flex items-center space-x-4 animate-in fade-in slide-in-from-bottom-4">
                                                        <div className="flex items-center px-4 py-2 bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-300 rounded-full border border-green-200 dark:border-green-800 text-sm font-medium">
                                                            <CheckCircle2 className="w-4 h-4 mr-2" /> Saved
                                                        </div>
                                                        <button onClick={resetAudio} className="text-sm text-slate-500 hover:text-slate-700 underline">Retry</button>
                                                    </div>
                                                )}
                                            </div>
                                        )}
                                    </div>

                                    <div className="p-4 border-t border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900/50 rounded-b-xl flex justify-end">
                                        <button onClick={() => handleAnalyze(false)} disabled={loading} className={`flex items-center px-6 py-2.5 rounded-lg font-medium text-white shadow-md transition-all ${loading ? 'bg-slate-400 cursor-not-allowed' : 'bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700'}`}>
                                            {loading ? <><Loader2 className="w-4 h-4 mr-2 animate-spin" /> Analyzing...</> : <><Send className="w-4 h-4 mr-2" /> Analyze</>}
                                        </button>
                                    </div>
                                </div>

                                {error && (
                                    <div className="bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 text-red-700 dark:text-red-300 p-4 rounded-lg flex items-center">
                                        <AlertCircle className="w-5 h-5 mr-3 flex-shrink-0" /> {error}
                                    </div>
                                )}

                                {result && (
                                    <div className="bg-white dark:bg-slate-800 rounded-xl shadow-lg border border-indigo-100 dark:border-slate-700 overflow-hidden animate-in fade-in slide-in-from-bottom-4">
                                        <div className="bg-gradient-to-r from-indigo-600 to-purple-600 px-6 py-4 flex items-center text-white">
                                            <CheckCircle2 className="w-6 h-6 mr-3" />
                                            <h2 className="font-bold text-lg">Result</h2>
                                        </div>
                                        <div className="p-8 bg-slate-50/50 dark:bg-slate-800">
                                            <MarkdownRenderer content={result} />
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    </main>

                    {/* Help Modal */}
                    {showHelp && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm animate-in fade-in">
                            <div className="bg-white dark:bg-slate-800 rounded-2xl shadow-2xl max-w-lg w-full overflow-hidden border border-slate-200 dark:border-slate-700 flex flex-col max-h-[90vh]">
                                <div className="p-6 overflow-y-auto">
                                    <div className="flex justify-between items-center mb-4">
                                        <h3 className="text-xl font-bold text-slate-900 dark:text-white">Welcome to Adjudicator AI</h3>
                                        <button onClick={() => setShowHelp(false)} className="text-slate-400 hover:text-slate-600 dark:hover:text-slate-200">
                                            <X className="w-6 h-6" />
                                        </button>
                                    </div>
                                    <div className="space-y-4 text-slate-600 dark:text-slate-300 text-sm">
                                        <p>Your personal AI debate coach and adjudicator. Here's how to use it:</p>
                                        <ul className="space-y-3">
                                            <li className="flex items-start">
                                                <div className="bg-indigo-100 dark:bg-indigo-900/30 p-2 rounded-lg mr-3 mt-0.5 flex-shrink-0">
                                                    <Mic className="w-4 h-4 text-indigo-600 dark:text-indigo-400" />
                                                </div>
                                                <div>
                                                    <strong className="block text-slate-800 dark:text-slate-200">Judge Text</strong>
                                                    Paste your speech transcript to get a score and detailed feedback.
                                                </div>
                                            </li>
                                            <li className="flex items-start">
                                                <div className="bg-purple-100 dark:bg-purple-900/30 p-2 rounded-lg mr-3 mt-0.5 flex-shrink-0">
                                                    <Layout className="w-4 h-4 text-purple-600 dark:text-purple-400" />
                                                </div>
                                                <div>
                                                    <strong className="block text-slate-800 dark:text-slate-200">Evaluate Board</strong>
                                                    Upload photos of your flow/board for strategy and organization tips.
                                                </div>
                                            </li>
                                            <li className="flex items-start">
                                                <div className="bg-pink-100 dark:bg-pink-900/30 p-2 rounded-lg mr-3 mt-0.5 flex-shrink-0">
                                                    <Activity className="w-4 h-4 text-pink-600 dark:text-pink-400" />
                                                </div>
                                                <div>
                                                    <strong className="block text-slate-800 dark:text-slate-200">Live Coach</strong>
                                                    Record your speech audio for delivery and content analysis.
                                                </div>
                                            </li>
                                        </ul>
                                        <div className="mt-4 p-3 bg-slate-100 dark:bg-slate-900 rounded-lg text-xs text-slate-500">
                                            <strong>Note:</strong> You'll need a Gemini API key to start. Enter it in the Configuration section.
                                        </div>
                                    </div>
                                </div>
                                <div className="p-4 bg-slate-50 dark:bg-slate-900/50 border-t border-slate-200 dark:border-slate-700 flex justify-end flex-shrink-0">
                                    <button onClick={() => setShowHelp(false)} className="px-6 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg font-medium transition-colors w-full sm:w-auto">
                                        Get Started
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>